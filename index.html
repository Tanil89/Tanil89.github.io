<!doctype html>
<html lang="en" data-theme="coffee">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link
        href="https://cdn.jsdelivr.net/npm/daisyui@4.10.3/dist/full.min.css"
        rel="stylesheet"
        type="text/css"
    />
    <link 
        href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.min.css"
        rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=typography,aspect-ratio,line-clamp,container-queries"></script>
    <title>Tanil's Quest Logs: Character Stories and Roleplaying Reflections</title>
    <meta property="og:title" content="Tanil's Quest Logs" />
	<meta property="og:description" content="in this blog you will find my characters, with their backgrounds, and their sessions told from their point of view." />
	<meta property="og:type" content="website" />
</head>
<body>
    <div class="drawer ">
        <!-- Drawler's toggle -->
        <input id="my-drawer" type="checkbox" class="drawer-toggle" />
        <!-- Drawler's content -->
        <div class="drawer-content">
            <!-- NAVBAR -->
            <div class="navbar bg-base-100 capitalize sticky top-0 z-30">
                <!-- drawer's bottom -->
                <div class="flex-none">
                    <label for="my-drawer" class="btn btn-primary drawer-button">
                        <svg 
                            xmlns="http://www.w3.org/2000/svg" fill="none" 
                            viewBox="0 0 24 24" 
                            class="inline-block w-5 h-5 stroke-current">
                            <path 
                                stroke-linecap="round" 
                                stroke-linejoin="round" 
                                stroke-width="2" 
                                d="M4 6h16M4 12h16M4 18h16">
                            </path>
                        </svg>
                    </label>
                </div>
                <!-- navbar's content -->
                <div class="flex-1">
                    <div id="nav_links"></div>
                </div>
                <!-- right nav bar -->
                <div class="flex-none">
                    
                    <!-- theme -->
                    <div class="dropdown dropdown-end">
                        <div tabindex="0" role="button" class="btn m-1">
                            Theme
                            <svg width="12px" height="12px" class="h-2 w-2 fill-current opacity-60 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2048 2048"><path d="M1799 349l242 241-1017 1017L7 590l242-241 775 775 775-775z"></path></svg>
                        </div>
                        <ul tabindex="0" class="dropdown-content z-[1] p-2 shadow-2xl bg-base-300 rounded-box w-52">
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="CHARACTER" value="default"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Emerald" value="emerald"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Retro" value="retro"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Valentine" value="valentine"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Halloween" value="halloween"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Forest" value="forest"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Aqua" value="aqua"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Dracula" value="dracula"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Autumn" value="autumn"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Business" value="business"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Night" value="night"/></li>
                            <li><input type="radio" name="theme-dropdown" class="theme-controller btn btn-sm btn-block btn-ghost justify-start" aria-label="Coffee" value="coffee"/></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- MAIN -->
            <div class="flex flex-col items-center justify-center h-full">
                <!-- breadcrumbs -->
                <div class="text-sm breadcrumbs capitalize w-full max-w-prose" id="breadcrumbs_over_article"></div>
                <!-- article -->
                <article class="prose prose-xl m-5" id="main"></article>
                <!-- footer -->
                <footer class="footer footer-center p-10 bg-neutral text-neutral-content w-full">
                    <aside class="items-center grid-flow-col ">
                        <p>CSS Framework: <a href="https://daisyui.com">DaisyUI</a> (built on <a href="https://tailwindcss.com">Tailwind CSS</a>)<br>
                            Made with ♥ by Tanil </p>
                        <img src="\assets\Tanil.png" class="h-20">
                    </aside>
                </footer>
            </div>
        </div>
        <!-- Drawler -->
        <div class="drawer-side capitalize z-40">
            <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu p-4 w-80 min-h-full bg-base-200  text-base-content" id="drawer-list">
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it-anchor@8.6.7/dist/markdownItAnchor.umd.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/markdown-it-toc-done-right@4.2.0/dist/markdownItTocDoneRight.umd.min.js"> -->
    </script>
    <script>
        "use strict";
        // use strict va messo perché sì (adattarsi a linguaggio moderno), cambia alcune regole del compilatore ad esempio se dimentico di definire una variabile non la crea automaticamente come farebbe js moderno ma da errore.

        // theme manager
        const newTheme = localStorage.getItem( '_pageTheme' )
        if ( newTheme ) document.querySelector( `input[name="theme-dropdown"][value="${newTheme}"]` ).checked = true
        Array.from( document.querySelectorAll( 'input[name="theme-dropdown"]' ) ).forEach( el => {
            el.addEventListener( 'change', (ev) => {
                localStorage.setItem( '_pageTheme', el.value )
            })
        })

        // call
        function scrollToID (id) {
            document.getElementById( id )?.scrollIntoView()
            scrollBy(0, -100)
        } 
        
        // refresh
        let _strRoute, _idScrollTo, _route
        let DB_json = {}
        const _page = {
            curr: {},
            parents: {},
        }
        async function _refresh () {
            //  get route
            [_strRoute, _idScrollTo] = decodeURIComponent(window.location.hash).replace( /^#!\/?/, '' ).split( '#' )
            _route = _strRoute.split( '/' )

            if (!_route[0]) {
                _route[0] = "home"
            }
            _page.curr = DB_json
            _page.parents = [ ]
            _route.forEach( el => { 
                _page.parents.push(_page.curr)
                _page.curr = _page?.curr?.children[el]
            })
            const parent = _page.parents[_page.parents.length - 1]
            // set article page
            const md = markdownit({
                html: true,
                breaks: true,
                linkify: true,
                typographer: true,
            })
            md.use(markdownItAnchor, {
                callback: (token, {title, slug}) => {
                    if (slug === _idScrollTo) {
                        setTimeout(() => {
                            scrollToID( _idScrollTo )
                        }, 200)
                    }
                },
                permalink: markdownItAnchor.permalink.headerLink({
                    safariReaderFix: true,
                    class: "no-underline",
                }),
            })
            //.use(window.markdownItTocDoneRight);

            const article_page = await(await fetch( _page?.curr?.link || (_page?.curr?.children ? "autoindex.html" : "404.html") )).text()
            let htmlContent = article_page;
            
            if (_page?.curr?.link?.endsWith('.md')) {
                htmlContent = md.render(article_page);
            }
            document.getElementById('main').innerHTML = htmlContent
            //  Drawler list
            const navlist = [ `
                    <!-- search -->
                    <label class="input input-bordered flex items-center gap-2">
                        <input type="text" class="grow" placeholder="Search" />
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 opacity-70"><path fill-rule="evenodd" d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z" clip-rule="evenodd" /></svg>
                    </label>
                    ` ]
            
            const headers = Array.from( document.querySelector('article').querySelectorAll('h2[id],h3[id],h4[id],h5[id],h6[id]') )

            if (headers.length) {
                navlist.push( '<div class="divider divider-accent">Page index</div>' )
                headers.forEach( el => {
                    navlist.push(`<li><a href="#!${_strRoute}#${el.id}">${el.innerText}</a></li>`)
                })
            }

            // next level
            if (_page?.curr?.children  ) {
                navlist.push( '<div class="divider divider-accent"> next level </div>' )
                Object.keys(_page?.curr?.children ).forEach( el => {
                    navlist.push( `<li><a href="#!${_route.join('/')}/${el}">${el.replace("_", " ")}</a></li>` )
                })
            }
            // current level
            if (parent?.children && parent !== DB_json ) {
                navlist.push( '<div class="divider divider-accent"> current level </div>' )
                Object.keys(parent?.children).forEach( el => {
                    navlist.push( `<li><a href="#!${_route.slice(0, -1).join('/')}/${el}">${el.replace("_", " ")}</a></li>` )
                })
            }
            // previous level
            const grandparent = _page.parents[_page.parents.length-2]
            if (!_page?.curr?.children && grandparent && grandparent !== DB_json ) {
                navlist.push( '<div class="divider divider-accent"> previous level </div>' )
                Object.keys(grandparent?.children).forEach( el => {
                    navlist.push( `<li><a href="#!${_route.slice(0, -2).join('/')}/${el}">${el.replace("_", " ")}</a></li>` )
                })
            }
            // navigation level
            navlist.push( '<div class="divider divider-accent"> Navigation\'s links </div>' )
            Object.entries(DB_json.children).forEach( ([el, val]) => {
                navlist.push( `<li><a href="#!${el}"><i class="ri-${val?.meta?.icon || 'arrow-right-s'}-line"></i>${el.replace("_", " ")}</a> </li>`)
            })
            document.getElementById( 'drawer-list' ).innerHTML = navlist.join( '\n' )
            // breadcrumbs
            const bread_path = ['<ul>']
            _route.forEach( (el, i) => {
                bread_path.push( `<li><a href="#!${_route.slice(0,i+1).join('/')}"><div class="badge badge-neutral ">${el}</div></a></li>` )
            })
            bread_path.push('</ul>')
            document.getElementById( 'breadcrumbs_over_article' ).innerHTML = bread_path.join( '\n' )
            // Metadata handler
            document.documentElement.dataset.theme = _page.curr?.meta?.theme || parent?.meta?.theme || DB_json?.meta?.theme
            document.title = _page.curr?.meta?.titlepage || parent?.meta?.titlepage || DB_json?.meta?.titlepage
            // Inject article scripts
            Array.from( document.querySelectorAll( 'textarea[data-script]' ) ).forEach( el => {
                const newScript = document.createElement( 'script' )
                newScript.setAttribute('type', 'module')
                newScript.innerHTML = el.value
                document.body.appendChild( newScript )
                el.remove()
            })

            scrollToID( _idScrollTo )
        }
        // click handler
        document.addEventListener( 'click', async (ev) => {
            const el = ev.target.closest( 'a[href^="#!"]' )
            if ( !el ) return;
            window.location.hash = el.getAttribute( 'href' )
            await _refresh()
            ev.preventDefault()
        })
        // refresh
        ;(async () => {
            DB_json = await(await fetch( "sitemap.json" )).json()
            const navlist = [ ]
            Object.entries(DB_json.children).forEach( ([el, val]) => {
                navlist.push( `<a class="btn btn-ghost text-xl ${val?.meta?.icon ? '' : 'hidden sm:inline-flex'} " href="#!${el}"> <i class="ri-${val?.meta?.icon || 'arrow-right-s'}-line"></i><span class="hidden sm:inline">${el.replace("_", " ")}</span></a>`)
            })
            document.getElementById( 'nav_links' ).innerHTML = navlist.join( ' ' )

            
           // <a class="btn btn-ghost text-xl" href="#!characters">Characters</a>


            await _refresh()
        })();
    </script>
</body>
</html>